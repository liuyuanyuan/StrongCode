# Linux的用户与用户组管理

在Linux系统中，需要用户和密码来登陆主机，以取得shell环境来工作。每个登陆的用户至少取得两个标识符(Identifier，ID)：一个用户ID(UserID，简称UID)和一个用户组ID(GroupId，简称GID)。

系统的账号主要分为系统管理员（root）和一般用户。

本章主要介绍：

- 用户账号UID/GID管理 /etc/passwd
- 用户密码管理 /etc/shadow
- 用户组及成员管理 /etc/group
- 账号管理

## 用户账号UID/GID管理 /etc/passwd

用户账号UID/GID管理参数存储在/etc/passwd文件中。

文件构造：文件中一行代表一个账号，有几行代表该系统有几个账号（其中有几个系统正常运行必须的账号，简称系统账号，如：bin，daemin，adm，nobody等）。

行数据构造：冒号分隔，共7个字段（注意：中间无空格），如下所示：

​	**账号名称:密码:UID:GID:全名:文件夹:shell**

> **账号名称：**账号名称。
>
> **密码：**
>
> 早期UNIX系统的密码就存在该字段中，但因该文件所有程序均可读取，容易造成密码数据被窃取。因此，后来就将密码数据放到/etc/shadow中了，该字段只存一个x。
>
> **UID：**
>
>  用户标识符。通常Linux对UID有如下限制：root用户对UID为0。
>
> | ID范围                 | 该ID用户特性 |
> | ---------------------- | ------------ |
> | 0（系统管理员）        |              |
> | 1-499（系统账号）      |              |
> | 500-6535（可登陆账号） |              |
>
> **GID：**
>
> 是/etc/group中存储的与组名对应的GID。（类似于/etc/passwd中账号名对应的UID）
>
> 是该用户的初始用户组。
>
> **全名：**
>
> 
>
> **主文件夹：**
>
> 用户的主文件夹。比如：root的主文件夹在/root中，当root登陆后就立即切到/root目录下。
>
> **Shell：**
>
> 当用户登陆系统后就会取得一个shell，来与系统的内核通信，以进行用户的操作任务。
>
> 在该字段指定/bin/bash，shell会使用bash，一般都是这样设置的。
>
> 特殊的，如果该字段指定/sbin/nologin，那么用户登陆就变成了无法取得shell环境的登陆操作。		
>



## 用户密码管理 /etc/shadow

账号的密码目前已经移动到/etc/shadow文件中，该文件的权限只有root可以改动。

文件行数据构造：冒号分隔，共9个字段（注意：中间无空格），如下所示：

​	**账号名称:加密密码:密码更动日期:密码最小可变动日期:密码最大需变动日期:密码过期前警告天数:密码失效天数:账号失效日期:保留未使用**

>**加密密码：**此处的密码是加密后的，以前是DES加密，现在是MD5加密。



## 用户组及成员管理 /etc/group

用户组的配置文件时/etc/group，用于记录GID与组名的对应关系。

文件构造：文件中一行代表一个用户组，

行数据构造：冒号分隔，共4个字段（注意：中间无空格），如下所示：

​	**用户组名称:用户组密码:GID:此用户组支持的账号名称**

>**用户组密码：**该设置通常是给“用户组管理员”使用的，因为很少需要设置用户组管理员，所以该字段本来就很少设置。同样，又因为密码已经移动到/etc/shadow，因此该字段只存一个“x”。
>
>**GID：**此用户组的ID。/etc/passwd中第4个字段使用的GID源自此处。
>
>**此用户组支持的账号名称(次要用户组)：**该字段设置多个账号名称时，用逗号分隔，注意中间不得有空格。



#### 有效用户组（effective group）与 初始用户组（initial group）

一个用户可以支持多个用户组。

- 写入/etc/password的第4个(GID）字段者，称为**初始用户组**。当用户登陆系统，立刻就拥有这个用户组的相关权限。

- 在新建文件或目录时，就影响新文件或目录的用户组者，为**有效用户组**；

  > **新建文件或目录后，它的用户组如何确定？**
  >
  > 首先检查当前的有效用户组（effective group），通过：
  >
  > ​	1.登陆x用户
  >
  > ​    2.执行groups，返回：有效用户组与支持的用户组，所有用户组都是当前用户所属的用户组。
  >
  


## 账号管理（useradd， passwd）

新增用户是用useradd命令，详细命令项如下：

``` 
useradd [-u UID] [-g 初始用户组] [-G 次要用户组] [-mM] [-c 说明栏] [-d 主文件夹绝对路径] [-s shell] 用户账号名
```

为用户添加密码使用：`passwd 账号名`

​	因为，Linux已经规定了很多默认值，所以可以简单的使用“useradd 账号名”来创建用户。centos中的默认值如下：

- 在/etc/passwd创建一行与账号相关的数据，包括创建UID/GID/主文件夹等；
- 在/etc/shadow将此账号相关的参数填入，但是未有密码；
- 在/etc/group里加入一个与账号名一模一样的组名；
- 在/home下面，创建一个与账号名同名的目录作为主文件夹，且权限为700；
- 由于在/etc/shadow内仅会有密码参数，而不会有加密过的密码数据，因此，创建完用户账号后，还需要使用“passwd 账号名”来给账号添加密码，才算完成了用户创建的流程。







​	